<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:;base64,=">
    <title>Diep vs ondiep temperatuur zeewater </title>
    <script src="./js/d3.v6.js"></script>
    <style>
        #tzw_diep_vs_ondiep > svg:hover {
            cursor: move;
        }
    </style>
    <link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
    <link rel="manifest" href="./images/site.webmanifest">
    <link rel="shortcut icon" href="./images/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/files/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
        <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
</head>
<body>
<div id="tzw_diep_vs_ondiep"></div>

</body>
<footer>
    <script>

        // set the dimensions and margins of the graph
        const margin = {top: 60, right: 20, bottom: 20, left: 30},
            width = 920 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        const svg = d3.select("#tzw_diep_vs_ondiep")
            .append("svg")
            .attr("viewBox", [0, 0, width, height + margin.top + margin.bottom]);


        //Read the data
        d3.csv("./data/diepvsondiep.csv").then(function (data) {

            // List of subgroups = header of the csv files = soil condition here
            const subgroups = ["Ondiep", "Diep"]

            // List of groups = species here = value of the first column called group -> I show them on the X axis
            const groups = data.map(d => new Date(d.year, d.month - 1));

            data = data.map((d) => {
                return subgroups.map((key)=> {
                    if (key === "Ondiep") {
                        return {group: key, value: d.mean_x, key: new Date(d.year, d.month - 1)};
                    }
                    return {group: key, value: d.mean_y, key: new Date(d.year, d.month - 1)};
                });
            }).flat()

            // Add X axis
            const x = d3.scaleTime()
                .domain(d3.extent(groups))
                .range([margin.left, width + margin.left])
            svg.append("g")
                .attr("transform", `translate(0, ${height + margin.top})`)
                .call(d3.axisBottom(x));

            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0,20])
                .range([height + margin.top, margin.top]);
            svg.append("g")
                .attr("transform", `translate(${margin.left}, 0)`)
                .call(d3.axisLeft(y));

            // Another scale for subgroup position?
            const xSubgroup = d3.scaleBand()
                .domain(subgroups)
                .range([0, width / data.length])
                .padding([0.05])

            // color palette = one color per subgroup
            const color = d3.scaleSequential(d3.interpolateBlues)
                .domain([0,1])
            // Show the bars
            svg.append("g")
                .selectAll("rect")
                .data(data)
                .join("rect")
                .attr("class",d=>d.group)
                .attr("transform", d => `translate(${x(d.key)}, 0)`)
                .attr("x", d => xSubgroup(d.group))
                .attr("y", d => y(d.value))
                .attr("width", xSubgroup.bandwidth())
                .attr("height", d => height - y(d.value) + margin.top)
                .attr("fill", d => color((subgroups.indexOf(d.group)+0.6)));


            // Add a legend (interactive)
            svg
                .selectAll("myLegend")
                .data(subgroups)
                .join('g')
                .append("text")
                .attr('x', (d, i) => 30 + i * 60)
                .attr('y', 30)
                .text(d => d)
                .attr("fill", d => color((subgroups.indexOf(d)+0.6)))
                .style("font-size", 15)
                .on("click", (event, d) => {
                    // is the element currently visible ?
                    let currentOpacity = d3.selectAll("." + d).style("opacity")
                    // Change the opacity: from 0 to 1 or from 1 to 0
                    d3.selectAll("." + d).transition().style("opacity", currentOpacity == 1 ? 0 : 1)

                })
        })
    </script>
</footer>
</html>