<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:;base64,=">
    <title>Wind en Golven</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
    <link rel="manifest" href="./images/site.webmanifest">
    <link rel="shortcut icon" href="./images/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/files/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>
        let uid_count = 0;

        function uid(name) {
            return new Id("O-" + (name == null ? "" : name + "-") + ++uid_count);
        }

        function Id(id) {
            this.id = id;
            this.href = new URL(`#${id}`, location) + "";
        }

        Id.prototype.toString = function () {
            return "url(" + this.href + ")";
        };

    </script>
    <script src="./js/d3.v6.js"></script>
    <style>
        #zon_temp > svg:hover {
            cursor: move;
        }

        .dotted {
            stroke: #5c5c5c;
            stroke-dasharray: 1 1;
            fill: none;
        }

        svg text.value-text {
            font-size: .7rem;
            paint-order: stroke;
            stroke: #FFFFFF;
            stroke-width: 2px;
            stroke-linecap: butt;
            stroke-linejoin: miter;
        }

        button {
            background-color: rgba(51, 51, 51, 0.05);
            border-radius: 8px;
            border-width: 0;
            color: #333333;
            cursor: pointer;
            display: inline-block;
            font-family: "Haas Grot Text R Web", "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
            line-height: 20px;
            list-style: none;
            margin: 0;
            padding: 10px 12px;
            text-align: center;
            transition: all 200ms;
            vertical-align: baseline;
            white-space: nowrap;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
    </style>
</head>
<body>
<button onclick="module.zomer()">Maand in de zomer</button>
<button onclick="module.winter()">Maand in de winter</button>
<button onclick="module.all()">Geheel 2023</button>
<div id="temp_zon"></div>
<script type="text/javascript">
    const module = {};
</script>
<script type="module">
    const margin = {top: 10, right: 60, bottom: 30, left: 60},
        width = 920 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    const myColor = d3.scaleSequential(d3.interpolateBlues).domain([0, 1]);

    const zon_color = myColor(.5);
    const temp_color = myColor(1);

    const data = await d3.csv('/data/zon_temp.csv', d3.autoType);


    const datum_extent = d3.extent(data, d => d.datum),
        zon_extent = d3.extent(data, d => d.zon),
        temp_extent = d3.extent(data, d => d.temp);

    const x_scale = d3.scaleTime()
        .domain(datum_extent)
        .range([margin.left, width - margin.right]);

    const y_zon_scale = d3.scaleLinear()
        .domain(zon_extent)
        .range([height + margin.top, margin.top]);

    const y_temp_scale = d3.scaleLinear()
        .domain(temp_extent)
        .range([height + margin.top, margin.top]);

    const x_axis = (g, x) => g
        .attr("transform", `translate(0, ${height + margin.top})`)
        .call(d3
            .axisBottom(x)
            .ticks(width / 80)
            .tickSizeOuter(0)
        );

    const y_axis_zon = (g, y) => g
        .attr("transform", `translate(${width - margin.right}, 0)`)
        .attr("color", zon_color)
        .call(d3.axisRight(y).ticks(null, "s"))
        .call(g => g.select(".domain").remove())
        .call(g => g.select(".tick:last-of-type text").clone()
            .attr("x", 3)
            .attr("text-anchor", "start")
            .attr("font-weight", "bold")
        );

    const y_axis_temp = (g, y) => g
        .attr("transform", `translate(${margin.left}, 0)`)
        .attr("color", temp_color)
        .call(d3.axisLeft(y).ticks(null, "s"))
        .call(g => g.select(".domain").remove())
        .call(g => g.select(".tick:last-of-type text").clone()
            .attr("x", 3)
            .attr("text-anchor", "start")
            .attr("font-weight", "bold")
        );

    const line = (data, field, x, y) => d3.line()
        .x(d => x(d.datum))
        .y(d => y(d[field]))
        (data, field);

    const zoom = d3.zoom()
        .scaleExtent([1, 32])
        .extent([[margin.left, 0], [width - margin.right, height]])
        .translateExtent([[margin.left, -Infinity], [width - margin.right, Infinity]])
        .on("zoom", zoomed);

    const svg = d3.select('#temp_zon')
        .append('svg')
        .attr("viewBox", [0, 0, width, height + margin.top + margin.bottom]);
    //        .on("mouseenter", onMouseEnter)
    //      .on("mousemove", onMouseMove)
    //    .on("mouseleave", onMouseLeave);

    const clip = uid("clip");

    svg.append("clipPath")
        .attr("id", clip.id)
        .append("rect")
        .attr("x", margin.left)
        .attr("y", margin.top)
        .attr("width", width - margin.left - margin.right)
        .attr("height", height);

    const zon_path = svg.append("path")
        .attr("clip-path", clip)
        .attr("fill", "none")
        .attr("stroke", zon_color)
        .attr("d", line(data, "zon", x_scale, y_zon_scale));

    const temp_path = svg.append("path")
        .attr("clip-path", clip)
        .attr("fill", "none")
        .attr("stroke", temp_color)
        .attr("d", line(data, "temp", x_scale, y_temp_scale));


    const gx = svg.append("g")
        .call(x_axis, x_scale);

    svg.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "end")
        .attr("x", width / 2)
        .attr("y", height + margin.bottom + margin.top)
        .attr("text-anchor", "middle")
        .attr("style", "font-size: 0.8em")
        .text("Datum");

    svg.append("g")
        .call(y_axis_temp, y_temp_scale);

    svg.append("text")
        .attr("class", "y label")
        .attr("text-anchor", "end")
        .attr("x", -height / 2)
        .attr("y", margin.left / 2 - 12)
        .attr("dy", ".75em")
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .attr("style", `font-size: 0.8em`)
        .attr("fill", temp_color)
        .text("Zonnestraling (W/m²)");

    svg.append("g")
        .call(y_axis_zon, y_zon_scale);

    svg.append("text")
        .attr("class", "y label")
        .attr("text-anchor", "end")
        .attr("x", -height / 2)
        .attr("y", width - (margin.right / 2))
        .attr("dy", ".75em")
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .attr("style", `font-size: 0.8em`)
        .attr("fill", zon_color)
        .text("Zeewatertemperatuur (°C)");

    svg.call(zoom)
        .transition()
        .duration(250)
        .call(zoom.scaleTo, 16, [x_scale(Date.UTC(2023, 4, 9)), 0]);

    function zoomed(event) {
        let xz = event.transform.rescaleX(x_scale);
        zon_path.attr("d", line(data, "zon", xz, y_zon_scale));
        temp_path.attr("d", line(data, "temp", xz, y_temp_scale));
        gx.call(x_axis, xz);
    }

    function winter() {
        d3.select('#temp_zon')
            .transition()
            .duration(250)
            .call(zoom.scaleTo, 16, [x_scale(Date.UTC(2023, 1, 9)),0]);
    }

    function zomer() {
        d3.select('#temp_zon')
            .transition()
            .duration(250)
            .call(zoom.scaleTo, 16, [x_scale(Date.UTC(2023, 4, 9)), 0]);

    }

    function all() {

        d3.select('#temp_zon')
            .transition()
            .duration(250)
            .call(zoom.scaleTo, 1);
    }

    module.zomer = zomer;
    module.all = all;
    module.winter = winter;
</script>
</body>
</html>